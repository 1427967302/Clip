!function(root,fn){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=root.document?fn(root,void 0):function(w){if(!w.document)throw new Error("document does not exist !");return fn(w)}:fn(root,void 0)}(window||this,function(w,u){var Clip=function(element,options){if(1!==element.nodeType)throw"function"==typeof t.opt.error&&t.opt.error(),new Error("aguments[0] not is element");var opt={file:null,clipSize:[200,200],outputSize:1,wheelScale:!0,scaleValue:10,CrossOrigin:!1,fillBackground:"",rangeStyle:null,loaddone:null,scaleChange:null,error:null},t=this;if(!((opt=Object.assign(opt,options)).clipSize instanceof Array)||opt.clipSize.length<2||isNaN(Number(opt.clipSize[0]))||isNaN(Number(opt.clipSize[1])))throw"function"==typeof t.opt.error&&t.opt.error(),new Error("options.clipSize invalid value");if(opt.outputSize&&isNaN(opt.outputSize))throw"function"==typeof t.opt.error&&t.opt.error(),new Error("options.outputSize invalid value");t.el=element,t.opt=opt,opt.file&&init(t,opt.file)};function create(t){var el=t.el,position=getComputedStyle(el).position;/(fixed|absolute|relative)/.test(position)||(el.style.position="relative"),el.innerHTML="",el.style.overflow="hidden",el.style.userSelect="none";var elW=el.clientWidth,elH=el.clientHeight,fragment=document.createDocumentFragment(),layer=document.createElement("div"),clipAreaStyle="position: absolute; top: 50%; left: 50%; pointer-events: none; box-sizing: border-box; text-align: left;";layer.className="clip-layer",layer.setAttribute("style",clipAreaStyle),layer.style.width=t.opt.clipSize[0]+"px",layer.style.height=t.opt.clipSize[1]+"px",layer.style.marginLeft=-t.opt.clipSize[0]/2+"px",layer.style.marginTop=-t.opt.clipSize[1]/2+"px";var layerImg=new Image;t.opt.CrossOrigin&&(layerImg.crossOrigin="anonymous"),layerImg.src=t.sourceImageURL,layerImg.onload=function(e){t.sourceImage=this,t.sourceImageWidth=this.width,t.sourceImageHeight=this.height;var imgRatio=this.width/this.height;this.width=t.opt.clipSize[0],this.height=this.width/imgRatio,layer.appendChild(this),t.imageScaleRatio=this.width/t.sourceImageWidth,t.imageScaleMin=t.opt.clipSize[0]/5/t.sourceImageWidth,t.imageScaleMax=5*t.opt.clipSize[0]/t.sourceImageWidth,this.style.position="relative",this.style.left=-(this.width-t.opt.clipSize[0])/2+"px",this.style.top=-(this.height-t.opt.clipSize[1])/2+"px",this.removeAttribute("height"),"function"==typeof t.opt.loaddone&&t.opt.loaddone()},layerImg.onerror=function(){"function"==typeof t.opt.error&&t.opt.error()},fragment.appendChild(layer);var mask=document.createElement("div"),maskStyle="position: absolute; top: 0; right: 0; bottom: 0; left: 0; pointer-events: none; box-sizing: border-box;";mask.className="clip-mask",mask.setAttribute("style",maskStyle);var maskCenter=document.createElement("div");maskCenter.className="clip-mask-center",maskCenter.setAttribute("style",clipAreaStyle),maskCenter.style.width=t.opt.clipSize[0]+"px",maskCenter.style.height=t.opt.clipSize[1]+"px",maskCenter.style.marginLeft=-t.opt.clipSize[0]/2+"px",maskCenter.style.marginTop=-t.opt.clipSize[1]/2+"px";var rangeStyle=t.opt.rangeStyle;for(var rangeItem in maskCenter.style.border="1px dashed #007dfe",rangeStyle)maskCenter.style[rangeItem]=rangeStyle[rangeItem];var maskTop=document.createElement("div");maskTop.className="clip-mask-top",maskTop.setAttribute("style","position: absolute; top: 0; right: 0; bottom: 50%; left: 0; background-color: rgba(0, 0, 0, 0.5);"),maskTop.style.marginBottom=t.opt.clipSize[1]/2+"px";var maskRight=document.createElement("div");maskRight.className="clip-mask-right",maskRight.setAttribute("style","position: absolute; top: 50%; right: 0; bottom: 50%; left: 50%; background-color: rgba(0, 0, 0, 0.5);"),maskRight.style.marginTop=-t.opt.clipSize[1]/2+"px",maskRight.style.marginBottom=-t.opt.clipSize[1]/2+"px",maskRight.style.marginLeft=t.opt.clipSize[0]/2+"px";var maskBottom=document.createElement("div");maskBottom.className="clip-mask-bottom",maskBottom.setAttribute("style","position: absolute; top: 50%; right: 0; bottom: 0; left: 0; background-color: rgba(0, 0, 0, 0.5);"),maskBottom.style.marginTop=t.opt.clipSize[1]/2+"px";var maskLeft=document.createElement("div");maskLeft.className="clip-mask-left",maskLeft.setAttribute("style","position: absolute; top: 50%; right: 50%; bottom: 50%; left: 0; background-color: rgba(0, 0, 0, 0.5);"),maskLeft.style.marginTop=-t.opt.clipSize[1]/2+"px",maskLeft.style.marginBottom=-t.opt.clipSize[1]/2+"px",maskLeft.style.marginRight=t.opt.clipSize[0]/2+"px",mask.appendChild(maskTop),mask.appendChild(maskBottom),mask.appendChild(maskRight),mask.appendChild(maskLeft),mask.appendChild(maskCenter),fragment.appendChild(mask),el.appendChild(fragment)}function bindDrag(t){var dragEl=t.el,isMobile=/(Mobile|iPhone|iPod|iPad|Linux|Android)/gi.test(w.navigator.userAgent),pointX,pointY,elLeft,elTop;function dragStart(e){var moveEl=t.sourceImage;elLeft=parseInt(moveEl.style.left),elTop=parseInt(moveEl.style.top),pointX=isMobile?e.changedTouches[0].clientX:e.clientX,pointY=isMobile?e.changedTouches[0].clientY:e.clientY,document.addEventListener(isMobile?"touchmove":"mousemove",dragMove),document.addEventListener(isMobile?"touchend":"mouseup",dragEnd),e.preventDefault()}function dragMove(e){var moveEl=t.sourceImage,moveX=(isMobile?e.changedTouches[0].clientX:e.clientX)-pointX,moveY=(isMobile?e.changedTouches[0].clientY:e.clientY)-pointY;moveEl.style.left=elLeft+moveX+"px",moveEl.style.top=elTop+moveY+"px"}function dragEnd(e){document.removeEventListener(isMobile?"touchmove":"mousemove",dragMove),document.removeEventListener(isMobile?"touchend":"mouseup",dragEnd)}isMobile?dragEl.ontouchstart=dragStart:dragEl.onmousedown=dragStart}function bindWheel(t){var wheelEl=t.el;wheelEl.onwheel=null,wheelEl.onwheel=function(e){var dy,value=(e.deltaY||e.wheelDeltaY)<0?t.opt.scaleValue:-t.opt.scaleValue;t.scale(value),e.preventDefault()}}function init(t,file){if(t.el.innerHTML="",t.el.onmousedown=null,t.el.onwheel=null,"string"==typeof file&&/^http(s)?:\/\//.test(file))t.sourceImageURL=file+"?t="+(new Date).getTime(),create(t),bindDrag(t),t.opt.wheelScale&&bindWheel(t);else{var fileReader=new FileReader;fileReader.readAsDataURL(file),fileReader.onload=function(e){if(fileReader.result.indexOf("image")<0)throw"function"==typeof t.opt.error&&t.opt.error(),new Error("options.file not is image");t.sourceImageURL=fileReader.result,create(t),bindDrag(t),t.opt.wheelScale&&bindWheel(t)},fileReader.onerror=function(e){"function"==typeof t.opt.error&&t.opt.error()}}}"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function assign(target,varArgs){if(null==target)throw new TypeError("Cannot convert undefined or null to object");for(var to=Object(target),index=1;index<arguments.length;index++){var nextSource=arguments[index];if(null!=nextSource)for(var nextKey in nextSource)Object.prototype.hasOwnProperty.call(nextSource,nextKey)&&(to[nextKey]=nextSource[nextKey])}return to},writable:!0,configurable:!0}),Clip.prototype={constructor:Clip,load:function(file){var t=this;if(!file)throw"function"==typeof t.opt.error&&t.opt.error(),new Error("file undefined");if(!t.opt.file)return init(t,file),this},set:function(key,value){if(void 0!==this.opt[key]&&void 0!==value)return this.opt[key]=value,"clipSize"===key&&create(this),"wheelScale"===key&&(value?bindWheel(this):this.el.onwheel=null),this},destroy:function(){this.sourceImage&&(this.el.innerHTML="",this.el.onmousedown=null,this.el.onwheel=null,delete this.el,delete this.opt,delete this.sourceImage,delete this.sourceImageURL)},toDataURL:function(type,quality){if(this.sourceImage){var imageType=type?"image/"+type:"image/png",imageQuality=quality||1,img=this.sourceImage,canvas=document.createElement("canvas"),outputRatio=this.opt.outputSize;canvas.width=this.opt.clipSize[0]*outputRatio,canvas.height=this.opt.clipSize[1]*outputRatio;var ctx=canvas.getContext("2d"),background=this.opt.fillBackground;return""!==background&&"transparent"!==background&&(ctx.fillStyle=background,ctx.fillRect(0,0,canvas.width,canvas.height)),ctx.drawImage(img,parseInt(img.style.left)*outputRatio,parseInt(img.style.top)*outputRatio,img.width*outputRatio,img.height*outputRatio),canvas.toDataURL(imageType,imageQuality)}},scale:function(value){if(this.sourceImage){if(isNaN(value))throw new Error("fn:scale agument[0] is not number");var v=Math.round(value),img=this.sourceImage,imgLeft=Number(getComputedStyle(img).left.slice(0,-2)),imgTop=Number(getComputedStyle(img).top.slice(0,-2));if(!(v<0&&img.width+v<=this.sourceImageWidth*this.imageScaleMin||v>0&&img.width+v>=this.sourceImageWidth*this.imageScaleMax)){img.width+=v,img.style.left=imgLeft-v/2+"px";var imgRatio=Number((img.height/img.width).toFixed(1));return img.style.top=imgTop-v/2*imgRatio+"px",this.imageScaleRatio=img.width/this.sourceImageWidth,"function"==typeof this.opt.scaleChange&&this.opt.scaleChange(this.imageScaleRatio),this}}}},w.Clip=Clip});